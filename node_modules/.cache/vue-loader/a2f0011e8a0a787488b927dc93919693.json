{"remainingRequest":"/Users/fengwanjie/file/IdeaProjects/mall/mall-system/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/fengwanjie/file/IdeaProjects/mall/mall-system/src/pages/shop/oders/Order.vue?vue&type=style&index=0&id=5178230a&scoped=true&lang=css&","dependencies":[{"path":"/Users/fengwanjie/file/IdeaProjects/mall/mall-system/src/pages/shop/oders/Order.vue","mtime":1677682822547},{"path":"/Users/fengwanjie/file/IdeaProjects/mall/mall-system/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fengwanjie/file/IdeaProjects/mall/mall-system/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1655715156000},{"path":"/Users/fengwanjie/file/IdeaProjects/mall/mall-system/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/fengwanjie/file/IdeaProjects/mall/mall-system/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fengwanjie/file/IdeaProjects/mall/mall-system/node_modules/vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoucmVmcmVzaCwNCi53YWl0U2VuZCwNCi53YWl0UGF5LA0KLmNhbmNlbCwNCi5maW5pc2ggew0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHJpZ2h0OiAwOw0KfQ0KLndhaXRTZW5kIHsNCiAgcmlnaHQ6IDExMHB4Ow0KfQ0KLndhaXRQYXkgew0KICByaWdodDogMjEwcHg7DQp9DQouY2FuY2VsIHsNCiAgcmlnaHQ6IDMxMHB4Ow0KfQ0KLmZpbmlzaCB7DQogIHJpZ2h0OiA0MTBweDsNCn0NCg=="},{"version":3,"sources":["Order.vue"],"names":[],"mappings":";AAkZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Order.vue","sourceRoot":"src/pages/shop/oders","sourcesContent":["<template>\r\n  <Container>\r\n    <template v-slot>\r\n      <SubHeader style=\"position: relative\">\r\n        <template v-slot>\r\n          管理本店所有订单\r\n          <el-button\r\n            size=\"medium\"\r\n            type=\"primary\"\r\n            @click=\"filterTable(0)\"\r\n            class=\"waitPay\"\r\n            >待付款</el-button\r\n          >\r\n          <el-button\r\n            size=\"medium\"\r\n            type=\"primary\"\r\n            @click=\"filterTable(1)\"\r\n            class=\"waitSend\"\r\n            >待发货</el-button\r\n          >\r\n          <el-button\r\n            size=\"medium\"\r\n            type=\"primary\"\r\n            @click=\"filterTable(2)\"\r\n            class=\"cancel\"\r\n            >已取消</el-button\r\n          >\r\n          <el-button\r\n            size=\"medium\"\r\n            type=\"primary\"\r\n            @click=\"filterTable(3, true)\"\r\n            class=\"finish\"\r\n            >已完成</el-button\r\n          >\r\n          <el-button\r\n            size=\"medium\"\r\n            type=\"primary\"\r\n            @click=\"refreshTable\"\r\n            class=\"refresh\"\r\n            >所有订单</el-button\r\n          >\r\n        </template>\r\n      </SubHeader>\r\n      <el-table :data=\"tableData\" style=\"margin-top: 10px\" border stripe>\r\n        <el-table-column\r\n          prop=\"index\"\r\n          label=\"序号\"\r\n          style=\"height: 30px\"\r\n          width=\"80px\"\r\n          align=\"center\"\r\n        ></el-table-column>\r\n        <el-table-column\r\n          width=\"140px\"\r\n          align=\"center\"\r\n          prop=\"orderNumber\"\r\n          label=\"订单编号\"\r\n        >\r\n        </el-table-column>\r\n        <el-table-column\r\n          width=\"100px\"\r\n          align=\"center\"\r\n          prop=\"createTime\"\r\n          label=\"下单时间\"\r\n        >\r\n        </el-table-column>\r\n        <el-table-column\r\n          width=\"100px\"\r\n          align=\"center\"\r\n          prop=\"realName\"\r\n          label=\"收货人姓名\"\r\n        >\r\n        </el-table-column>\r\n        <el-table-column align=\"center\" prop=\"address\" label=\"发货地址\">\r\n        </el-table-column>\r\n        <el-table-column\r\n          align=\"center\"\r\n          prop=\"orderAmount\"\r\n          label=\"订单总额（元）\"\r\n        >\r\n        </el-table-column>\r\n        <el-table-column width=\"100px\" align=\"center\" label=\"订单状态\">\r\n          <template slot-scope=\"scope\">\r\n            <el-tag\r\n              size=\"small\"\r\n              :type=\"\r\n                scope.row.orderStatus === 0\r\n                  ? 'danger'\r\n                  : scope.row.orderStatus === 1\r\n                  ? 'primary'\r\n                  : scope.row.orderStatus === 2\r\n                  ? 'info'\r\n                  : 'success'\r\n              \"\r\n            >\r\n              {{ currentStatus(scope.row.orderStatus) }}\r\n            </el-tag>\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column\r\n          width=\"220px\"\r\n          align=\"center\"\r\n          fixed=\"right\"\r\n          label=\"操作\"\r\n        >\r\n          <template slot-scope=\"scope\">\r\n            <el-button\r\n              :disabled=\"!(scope.row.orderStatus === 1)\"\r\n              type=\"success\"\r\n              @click.native.prevent=\"send(scope.$index, tableData)\"\r\n              size=\"mini\"\r\n              >发 货</el-button\r\n            >\r\n            <el-button\r\n              type=\"danger\"\r\n              size=\"mini\"\r\n              :disabled=\"!(scope.row.orderStatus < 2)\"\r\n              @click.native.prevent=\"cancel(scope.$index, tableData)\"\r\n              >取 消</el-button\r\n            >\r\n            <el-button\r\n              type=\"primary\"\r\n              size=\"mini\"\r\n              @click.native.prevent=\"detail(scope.$index, tableData)\"\r\n              >查看</el-button\r\n            >\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <el-pagination\r\n        @size-change=\"handleSizeChange\"\r\n        @current-change=\"handleCurrentChange\"\r\n        :page-sizes=\"[5, 10, 100]\"\r\n        :page-size=\"pageSize\"\r\n        layout=\"total, sizes, prev, pager, next, jumper\"\r\n        :total=\"total\"\r\n        style=\"margin-top: 10px\"\r\n      >\r\n      </el-pagination>\r\n\r\n      <!-- 弹出商品信息 -->\r\n      <el-dialog\r\n        title=\"订单包含商品信息\"\r\n        :visible.sync=\"dialogVisible\"\r\n        width=\"50%\"\r\n      >\r\n        <el-table :data=\"products\" style=\"margin-top: 10px\" border stripe>\r\n          <el-table-column\r\n            prop=\"index\"\r\n            label=\"序号\"\r\n            align=\"center\"\r\n          ></el-table-column>\r\n          <el-table-column prop=\"imgSrc\" label=\"商品图片\" align=\"center\">\r\n            <template #default=\"scope\">\r\n              <el-image\r\n                style=\"height: 80px\"\r\n                :src=\"scope.row.imgSrc\"\r\n                :preview-src-list=\"[scope.row.imgSrc]\"\r\n              ></el-image>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column\r\n            prop=\"productName\"\r\n            label=\"商品名称\"\r\n            align=\"center\"\r\n          ></el-table-column>\r\n          <el-table-column\r\n            prop=\"count\"\r\n            label=\"数量\"\r\n            align=\"center\"\r\n          ></el-table-column>\r\n          <el-table-column\r\n            prop=\"orderProductPrice\"\r\n            label=\"总价格\"\r\n            align=\"center\"\r\n          ></el-table-column>\r\n        </el-table>\r\n        <span slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button type=\"primary\" @click=\"dialogVisible = false\"\r\n            >确 定</el-button\r\n          >\r\n        </span>\r\n      </el-dialog>\r\n    </template>\r\n  </Container>\r\n</template>\r\n\r\n<script>\r\nimport request from '../../../utils/request'\r\n\r\nconst SubHeader = () => import('../../components/SubHeader.vue')\r\nconst Container = () => import('../../components/Container.vue')\r\n\r\nexport default {\r\n  components: {\r\n    SubHeader,\r\n    Container\r\n  },\r\n  data() {\r\n    return {\r\n      form: {},\r\n      dialogFormVisible: false,\r\n      // pageSize是表示一页最多可以装几条数据\r\n      pageSize: 10,\r\n      // 表示请求第几页数据\r\n      pageNum: 1,\r\n      // 查询关键字\r\n      key: '',\r\n      // 总共几条数据\r\n      total: 100,\r\n      tableData: [],\r\n      tempData: [],\r\n      shopId: null,\r\n      dialogVisible: false,\r\n      products: []\r\n    }\r\n  },\r\n  methods: {\r\n    detail(index, rows) {\r\n      this.dialogVisible = true\r\n      let oNumber = rows[index].orderNumber\r\n      request.get('product/order/' + oNumber).then((res) => {\r\n        if (res.code === '0') {\r\n          this.products = []\r\n          // this.products = res.data\r\n          res.data.forEach((e, i) => {\r\n            e.index = i + 1\r\n            this.products.push(e)\r\n            this.products.sort((a, b) => a.index - b.index)\r\n          })\r\n        }\r\n      })\r\n    },\r\n    filterTable(n, flag) {\r\n      if (flag) {\r\n        this.tableData = this.tempData.filter((item) => item.orderStatus >= n)\r\n        return\r\n      }\r\n      this.tableData = this.tempData.filter((item) => item.orderStatus === n)\r\n    },\r\n    // 刷新表格\r\n    refreshTable() {\r\n      this.load()\r\n      this.$message({\r\n        message: '刷新成功！',\r\n        type: 'success'\r\n      })\r\n    },\r\n    // 取消订单\r\n    cancel(index, rows) {\r\n      this.$confirm('此操作将取消该订单, 是否继续?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      })\r\n        .then(() => {\r\n          let oNumber = rows[index].orderNumber\r\n          request.patch('/order/cancel/' + oNumber).then((res) => {\r\n            if (res.code === '0') {\r\n              this.$message({\r\n                message: res.msg,\r\n                type: 'success',\r\n                duration: 1000\r\n              })\r\n              this.tableData[index].orderStatus = 2\r\n            }\r\n          })\r\n        })\r\n        .catch(() => {\r\n          this.$message({\r\n            type: 'info',\r\n            message: '已取消操作'\r\n          })\r\n        })\r\n    },\r\n    // 发货\r\n    send(index, rows) {\r\n      this.$confirm('确认发货吗?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      })\r\n        .then(() => {\r\n          let oNumber = rows[index].orderNumber\r\n          request.patch('/order/send/' + oNumber).then((res) => {\r\n            if (res.code === '0') {\r\n              this.$message({\r\n                message: res.msg,\r\n                type: 'success',\r\n                duration: 1000\r\n              })\r\n              this.tableData[index].orderStatus = 3\r\n            }\r\n          })\r\n        })\r\n        .catch(() => {\r\n          this.$message({\r\n            type: 'info',\r\n            message: '已取消操作'\r\n          })\r\n        })\r\n    },\r\n    handleSizeChange(val) {\r\n      // console.log(`每页 ${val} 条`)\r\n      this.pageSize = val\r\n      this.load()\r\n    },\r\n    handleCurrentChange(val) {\r\n      // console.log(`当前页: ${val}`)\r\n      this.pageNum = val\r\n      this.load()\r\n    },\r\n    // 加载表格数据\r\n    load() {\r\n      request\r\n        .get('/order/shop', {\r\n          params: {\r\n            pageNum: this.pageNum,\r\n            pageSize: this.pageSize,\r\n            shopId: this.shopId\r\n          }\r\n        })\r\n        .then((res) => {\r\n          // console.log(res)\r\n          if (res.code === '0') {\r\n            this.$message({\r\n              message: res.msg,\r\n              type: 'success',\r\n              duration: 1000\r\n            })\r\n            this.tableData = []\r\n            this.tempData = []\r\n            this.total = res.data.total\r\n            this.pageNum = res.data.pageNum\r\n            res.data.data.forEach((item, i) => {\r\n              item.index = i + 1\r\n              request\r\n                .get('/user/order_number/' + item.orderNumber)\r\n                .then((res) => {\r\n                  item.realName = res.realName\r\n                  item.address = res.address\r\n                  this.tableData.push(item)\r\n                  this.tempData.push(item)\r\n                  this.tableData.sort((a, b) => a.index - b.index)\r\n                  this.tempData.sort((a, b) => a.index - b.index)\r\n                })\r\n            })\r\n          }\r\n        })\r\n        .then(() => {})\r\n    },\r\n    currentStatus(n) {\r\n      if (n === 0) {\r\n        return '待付款'\r\n      }\r\n      if (n === 1) {\r\n        return '待发货'\r\n      }\r\n      if (n === 2) {\r\n        return '已取消'\r\n      }\r\n      if (n === 3) {\r\n        return '已完成'\r\n      }\r\n      return '已完成'\r\n    },\r\n    save() {\r\n      request\r\n        .post('/user', this.form)\r\n        .then((res) => {\r\n          if (res === 0) {\r\n            this.dialogFormVisible = false\r\n            this.$message({\r\n              message: '恭喜你，添加成功！',\r\n              type: 'success'\r\n            })\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err)\r\n        })\r\n        .then(() => {\r\n          // 刷新表格数据\r\n          this.load()\r\n        })\r\n    }\r\n  },\r\n  created() {\r\n    let uId = sessionStorage.getItem('userId')\r\n    request\r\n      .get('/user/shop_id/' + uId)\r\n      .then((res) => {\r\n        this.shopId = res\r\n      })\r\n      .then(() => {\r\n        this.load()\r\n      })\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.refresh,\r\n.waitSend,\r\n.waitPay,\r\n.cancel,\r\n.finish {\r\n  position: absolute;\r\n  right: 0;\r\n}\r\n.waitSend {\r\n  right: 110px;\r\n}\r\n.waitPay {\r\n  right: 210px;\r\n}\r\n.cancel {\r\n  right: 310px;\r\n}\r\n.finish {\r\n  right: 410px;\r\n}\r\n</style>"]}]}